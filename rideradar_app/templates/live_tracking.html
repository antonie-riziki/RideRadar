<!DOCTYPE html>
<html class="light" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Tracking - RideRadar</title>

  <!-- External Stylesheets -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />


  <!-- Tailwind Configuration -->
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#2b8dee",
            "background-light": "#f6f7f8",
            "background-dark": "#101922",
          },
          fontFamily: {
            "display": ["Plus Jakarta Sans", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "1rem",
            "lg": "2rem",
            "xl": "3rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>

  <!-- Global Styles -->
  <style type="text/tailwindcss">
    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
    }

    .sidebar-item-active {
      @apply bg-primary/10 text-primary;
    }

    .status-badge {
      @apply inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-tight;
    }

    .animate-pulse-slow {
      animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
  </style>

  <style>
    body {
      min-height: 100vh;
      overflow: hidden;
    }

    main {
      width: 100%;
      margin-left: 96px;
      margin-top: 64px;
      height: calc(100vh - 64px);
    }

    .map-wrapper {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
    }

    #map {
      width: 100%;
      height: clamp(400px, 60vh, 650px);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }

    .bus-icon {
      background: #2563eb;
      color: #fff;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      box-shadow: 0 6px 14px rgba(0,0,0,0.3);
    }

    .route-label {
      background: white;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid #ddd;
    }

  </style>


</head>


<body class="bg-background-light dark:bg-background-dark font-display text-[#0d141b] dark:text-white antialiased overflow-hidden h-screen flex">
  
  {% include 'user_sidebar.html' %}

  <!-- Main Content Area -->
  <main class="flex-1 relative flex flex-col items-center justify-start overflow-y-auto ml-24 mt-16 w-full pb-32">

    <!-- Map Container -->
    <div class="map-wrapper">
      <div id="map"></div>
    </div>

    <!-- Top Search Bar -->
    <div class="w-full max-w-4xl mx-auto px-4 mt-6 z-20 pointer-events-auto">
      <div class="flex items-center gap-4 pointer-events-auto">
        <div class="flex-1 bg-white dark:bg-background-dark rounded-2xl shadow-xl border border-slate-100 dark:border-slate-800 flex items-center px-5 h-14">
          <span class="material-symbols-outlined text-slate-400 mr-3">search</span>
          <input class="bg-transparent border-none focus:ring-0 text-base w-full placeholder:text-slate-400 dark:bg-background-dark dark:text-white" placeholder="Search routes..." type="text"/>
          <button class="p-1 text-slate-400 hover:text-primary">
            <span class="material-symbols-outlined">tune</span>
          </button>
        </div>
      </div>
    </div>

    
    <!-- Bottom Sheet - Vehicle Details -->
    <div class="w-full max-w-4xl mx-auto px-4 mt-8 z-20">
      <!-- Details Panel -->
      <div class="bg-white dark:bg-background-dark rounded-3xl shadow-2xl border border-slate-100 dark:border-slate-800 overflow-hidden">
        <!-- Drag Handle -->
        <div class="flex w-full items-center justify-center pt-4 pb-2">
          <div class="h-1.5 w-12 rounded-full bg-slate-200 dark:bg-slate-700"></div>
        </div>

        <!-- Details Content -->
        <div class="max-w-full px-6 pb-6">
          <!-- Header Section -->
          <div class="px-2 py-2 flex justify-between items-center">
            <div>
              <div class="flex items-center gap-2 mb-0.5">
                <h2 class="text-2xl font-bold tracking-tight">KDB 883Z</h2>
                <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase">Live</span>
              </div>
              <p class="text-slate-500 dark:text-slate-400 font-medium">Route 45 - Kahawa West</p>
            </div>
            <div class="size-12 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 rounded-2xl flex items-center justify-center">
              <span class="material-symbols-outlined fill-1">verified</span>
            </div>
          </div>

          <!-- Info Grid -->
          <div class="grid grid-cols-3 gap-4 px-2 py-6">
            <!-- ETA -->
            <div class="bg-slate-50 dark:bg-slate-800/40 p-4 rounded-3xl text-center border border-slate-100 dark:border-slate-800/50">
              <p class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-2">ETA</p>
              <p class="text-xl font-bold">15 <span class="text-xs font-normal text-slate-400">mins</span></p>
            </div>

            <!-- Occupancy -->
            <div class="bg-slate-50 dark:bg-slate-800/40 p-4 rounded-3xl text-center border border-slate-100 dark:border-slate-800/50">
              <p class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-2">Occupancy</p>
              <div class="flex items-center justify-center gap-1 text-amber-500">
                <span class="material-symbols-outlined text-base fill-1">group</span>
                <p class="text-sm font-bold">Full</p>
              </div>
            </div>

            <!-- Fare -->
            <div class="bg-slate-50 dark:bg-slate-800/40 p-4 rounded-3xl text-center border border-slate-100 dark:border-slate-800/50">
              <p class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-2">Fare</p>
              <p class="text-xl font-bold text-primary">60 <span class="text-xs font-normal text-slate-400">KES</span></p>
            </div>
          </div>

          <!-- Accident Notice -->
          <div class="mx-2 mb-6 p-4 bg-amber-50 dark:bg-amber-900/15 rounded-2xl border border-amber-200 dark:border-amber-800/40 flex items-center gap-4">
            <div class="bg-amber-100 dark:bg-amber-900/30 size-10 flex-shrink-0 rounded-xl shadow-sm text-amber-600 dark:text-amber-400 flex items-center justify-center">
              <span class="material-symbols-outlined text-[20px] fill-1">warning</span>
            </div>
            <div class="flex-1">
              <p class="text-xs font-bold text-amber-700 dark:text-amber-300 uppercase tracking-tight mb-0.5">Accident Alert</p>
              <p class="text-sm text-amber-900 dark:text-amber-100 leading-snug">Slight accident on Thika Road may cause +15 min delay.</p>
            </div>
          </div>

          <!-- Buy Ticket Button -->
          <div class="px-2">
            <button class="w-full bg-primary hover:bg-primary/90 text-white font-bold h-16 rounded-2xl shadow-xl shadow-primary/20 flex items-center justify-center gap-3 transition-transform active:scale-[0.98]">
              <span class="material-symbols-outlined">account_balance_wallet</span>
              Buy Ticket
            </button>
          </div>
        </div>
      </div>
    </div>


    <!-- Bottom Sheet - Vehicle Details -->
    <div class="w-full max-w-4xl mx-auto px-4 mt-8 z-20">
      <!-- Details Panel -->
      <div class="bg-white dark:bg-background-dark rounded-3xl shadow-2xl border border-slate-100 dark:border-slate-800 overflow-hidden">
        <!-- Drag Handle -->
        <div class="flex w-full items-center justify-center pt-4 pb-2">
          <div class="h-1.5 w-12 rounded-full bg-slate-200 dark:bg-slate-700"></div>
        </div>

        <!-- Details Content -->
        <div class="max-w-full px-6 pb-6">
          <!-- Header Section -->
          <div class="px-2 py-2 flex justify-between items-center">
            <div>
              <div class="flex items-center gap-2 mb-0.5">
                <h2 class="text-2xl font-bold tracking-tight">KCA 123X</h2>
                <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase">Live</span>
              </div>
              <p class="text-slate-500 dark:text-slate-400 font-medium">Route 102 - Dagoretti Corner</p>
            </div>
            <div class="size-12 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 rounded-2xl flex items-center justify-center">
              <span class="material-symbols-outlined fill-1">verified</span>
            </div>
          </div>

          <!-- Info Grid -->
          <div class="grid grid-cols-3 gap-4 px-2 py-6">
            <!-- ETA -->
            <div class="bg-slate-50 dark:bg-slate-800/40 p-4 rounded-3xl text-center border border-slate-100 dark:border-slate-800/50">
              <p class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-2">ETA</p>
              <p class="text-xl font-bold">4 <span class="text-xs font-normal text-slate-400">mins</span></p>
            </div>

            <!-- Occupancy -->
            <div class="bg-slate-50 dark:bg-slate-800/40 p-4 rounded-3xl text-center border border-slate-100 dark:border-slate-800/50">
              <p class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-2">Occupancy</p>
              <div class="flex items-center justify-center gap-1 text-amber-500">
                <span class="material-symbols-outlined text-base fill-1">group</span>
                <p class="text-sm font-bold">Medium</p>
              </div>
            </div>

            <!-- Fare -->
            <div class="bg-slate-50 dark:bg-slate-800/40 p-4 rounded-3xl text-center border border-slate-100 dark:border-slate-800/50">
              <p class="text-[10px] uppercase tracking-widest text-slate-400 font-bold mb-2">Fare</p>
              <p class="text-xl font-bold text-primary">50 <span class="text-xs font-normal text-slate-400">KES</span></p>
            </div>
          </div>

          <!-- Weather Notice -->
          <div class="mx-2 mb-6 p-4 bg-blue-50 dark:bg-primary/10 rounded-2xl border border-primary/10 flex items-center gap-4">
            <div class="bg-white dark:bg-background-dark size-10 flex-shrink-0 rounded-xl shadow-sm text-primary flex items-center justify-center">
              <span class="material-symbols-outlined text-[20px]">cloudy_snowing</span>
            </div>
            <div class="flex-1">
              <p class="text-xs font-bold text-primary uppercase tracking-tight mb-0.5">Weather Notice</p>
              <p class="text-sm text-slate-600 dark:text-slate-300 leading-snug">Rain may cause +5 min delay on Ngong Rd.</p>
            </div>
          </div>

          <!-- Buy Ticket Button -->
          <div class="px-2">
            <button class="w-full bg-primary hover:bg-primary/90 text-white font-bold h-16 rounded-2xl shadow-xl shadow-primary/20 flex items-center justify-center gap-3 transition-transform active:scale-[0.98]">
              <span class="material-symbols-outlined">account_balance_wallet</span>
              Buy Ticket
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- User Sidebar -->
  {% include 'user_sidebar.html' %}

  {% include 'chatbot.html' %}


  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // 1Ô∏è‚É£ Initialize map (Nairobi)
    const map = L.map("map").setView([-1.2864, 36.8172], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    // 2Ô∏è‚É£ SACCO Routes (Sample Data)
    const routes = [
      {
        name: "Route 46: CBD ‚Üí Westlands",
        color: "#2563eb",
        path: [
          [-1.2868, 36.8219],
          [-1.2921, 36.8223],
          [-1.2785, 36.8124],
          [-1.2673, 36.8047]
        ]
      },
      {
        name: "Route 105: CBD ‚Üí Kasarani",
        color: "#16a34a",
        path: [
          [-1.2868, 36.8219],
          [-1.2701, 36.8294],
          [-1.2532, 36.8406],
          [-1.2237, 36.9002]
        ]
      }
    ];

    // Draw routes
    routes.forEach(route => {
      const polyline = L.polyline(route.path, {
        color: route.color,
        weight: 5
      }).addTo(map);

      L.popup({ closeButton: false })
        .setLatLng(route.path[Math.floor(route.path.length / 2)])
        .setContent(`<div class="route-label">${route.name}</div>`)
        .openOn(map);
    });

    // 3Ô∏è‚É£ Bus Stops
    const stops = [
      { name: "Kencom Stage", coords: [-1.2868, 36.8219] },
      { name: "Museum Hill", coords: [-1.2785, 36.8124] },
      { name: "Westlands Stage", coords: [-1.2673, 36.8047] }
    ];

    stops.forEach(stop => {
      L.circleMarker(stop.coords, {
        radius: 6,
        color: "#111",
        fillColor: "#fff",
        fillOpacity: 1
      })
      .addTo(map)
      .bindPopup(`<b>${stop.name}</b><br>Bus Stop`);
    });

    // 4Ô∏è‚É£ Animated Vehicles
    function createBus(reg, route, eta, passengers) {
      let index = 0;

      const icon = L.divIcon({
        className: "",
        html: `<div class="bus-icon">üöå</div>`
      });

      const marker = L.marker(route.path[0], { icon }).addTo(map);

      marker.bindPopup(`
        <b>Vehicle:</b> ${reg}<br>
        <b>Route:</b> ${route.name}<br>
        <b>ETA:</b> ${eta}<br>
        <b>Passengers:</b> ${passengers}
      `);

      setInterval(() => {
        index = (index + 1) % route.path.length;
        marker.setLatLng(route.path[index]);
      }, 2000);
    }

    // Spawn vehicles
    createBus("KCA 123X", routes[0], "6 mins", 18);
    createBus("KCB 445Y", routes[1], "12 mins", 27);
  </script>

</body>
</html>